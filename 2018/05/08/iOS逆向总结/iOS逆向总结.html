<hr>
<p>title: iOS逆向工程总结<br>date: 2018-05-02 10:48:52</p>
<h2 id="tags-走走停停-已有三月逆向了。或许路没有尽头-但并不是放弃理由-难道最美的风景不是在路上吗-文章主要是提炼小黄书的内容-详细请自行看书"><a href="#tags-走走停停-已有三月逆向了。或许路没有尽头-但并不是放弃理由-难道最美的风景不是在路上吗-文章主要是提炼小黄书的内容-详细请自行看书" class="headerlink" title="tags: 走走停停,已有三月逆向了。或许路没有尽头,但并不是放弃理由~难道最美的风景不是在路上吗?文章主要是提炼小黄书的内容,详细请自行看书~"></a>tags: 走走停停,已有三月逆向了。或许路没有尽头,但并不是放弃理由~难道最美的风景不是在路上吗?文章主要是提炼小黄书的内容,详细请自行看书~</h2><hr>
<p>[TOC]</p>
<h3 id="iOS-逆向概念"><a href="#iOS-逆向概念" class="headerlink" title="iOS 逆向概念"></a>iOS 逆向概念</h3><h4 id="1-逆向的作用"><a href="#1-逆向的作用" class="headerlink" title="1.逆向的作用"></a>1.逆向的作用</h4><ul>
<li>通过分析目标程序，拿到关键信息 ,可以归类于安全相关的逆向工程<ol>
<li>评定安全等级</li>
<li>修改软件使用限制,逻辑,功能等</li>
<li>开发相关逆向工程</li>
</ol>
</li>
</ul>
<h4 id="2-逆向工具"><a href="#2-逆向工具" class="headerlink" title="2.逆向工具"></a>2.逆向工具</h4><table>
<thead>
<tr>
<th style="text-align:center">检测工具</th>
<th style="text-align:center">反汇编工具</th>
<th style="text-align:center">调试工具</th>
<th style="text-align:center">开发工具</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Reveal(监测UI)</td>
<td style="text-align:center">IDA</td>
<td style="text-align:center">lldb</td>
<td style="text-align:center">iOSOpenDev</td>
</tr>
<tr>
<td style="text-align:center">snoop-it(网络活动)</td>
<td style="text-align:center">Hopper</td>
<td style="text-align:center">\</td>
<td style="text-align:center">Theos</td>
</tr>
<tr>
<td style="text-align:center">introspy(分析应用程序)</td>
<td style="text-align:center">\</td>
<td style="text-align:center">\</td>
<td style="text-align:center">\</td>
</tr>
</tbody>
</table>
<h4 id="3-iOS-目录结构"><a href="#3-iOS-目录结构" class="headerlink" title="3.iOS 目录结构"></a>3.iOS 目录结构</h4><ul>
<li>·/：根目录，以斜杠表示，其他所有文件和目录在根目录下展开 </li>
<li>·/bin：“binary”的简写，存放提供用户级基础功能的二进制文件，如ls、ps等 </li>
<li>·/boot：存放能使系统成功启动的所有文件。iOS中此目录为空”</li>
<li>·/dev：“device”的简写，存放BSD设备文件” “每个文件代表系统的一个块设备或字符设备</li>
<li>·/sbin：“system binaries”的简写，存放提供系统级基础功能的二进制文件，如netstat、reboot等 </li>
<li>·/etc：“Et Cetera”的简写，存放系统脚本及配置文件，如passwd、hosts等。在iOS中，/etc是一个符号链接，实际指向/private/etc。 </li>
<li>·/lib：存放系统库文件、内核模块及设备驱动等。iOS中此目录为空 </li>
<li>·/mnt：“mount”的简写，存放临时的文件系统挂载点。iOS中此目录为空。 </li>
<li>·/private：存放两个目录，分别是/private/etc和/private/var </li>
<li>·/tmp：临时目录。在iOS中，/tmp是一个符号链接，实际指向/private/var/tmp。 </li>
<li>·/usr：包含了大多数用户工具和程序。/usr/bin包含那些/bin和/sbin中未出现的基础功能，如nm、killall等；/usr/include包含所有的标准C头文件；/usr/lib存放库文件。 </li>
<li>·/var：“variable”的简写，存放一些经常更改的文件，比如日志、用户数据、临时文件等”“其中/var/mobile和/var/root分别存放了mobile用户和root用户的文件，是重点关注的目录。 </li>
<li>/Applications：存放所有的系统App和来自于Cydia的App，不包括StoreApp </li>
<li>·/Developer：如果一台设备连接Xcode后被指定为调试用机（如图2-4所示），Xcode就会在iOS中生成这个目录 </li>
<li>·/Library：存放一些提供系统支持的数据 </li>
<li>·/System/Library：iOS文件系统中最重要的目录之一，存放大量系统组件 </li>
<li>·/System/Library/Frameworks和/System/Library/PrivateFrameworks：存放iOS中的各种framework，其中出现在SDK文档里的只是冰山一角，还有数不清的未公开功能等待我们去挖掘 </li>
<li>·/System/Library/CoreServices里的SpringBoard.app：iOS桌面管理器（类似于Windows里的explorer），是用户与系统交流的最重要中介 </li>
<li>/User：用户目录，实际指向/var/mobile  “·/var/mobile/Media/DCIM下存放照片 “ “·/var/mobile/Media/Recordings下存放录音文件；” “·/var/mobile/Library/SMS下存放短信数据库；” “·/var/mobile/Library/Mail下存放邮件数据。”  “非常重要的子目录是/var/mobile/Containers，存放StoreApp。值得注意的是，App的可执行文件在bundle与App中的数据目录被分别存放在/var/mobile/Containers/Bundle和/var/mobile/Containers/Data这两个不同目录下” </li>
</ul>
<h4 id="4-iOS二进制文件类型"><a href="#4-iOS二进制文件类型" class="headerlink" title="4.iOS二进制文件类型"></a>4.iOS二进制文件类型</h4><ul>
<li><p>Application</p>
<ul>
<li><p>1.bundle</p>
<ul>
<li>App和framework</li>
<li>PreferenceBundle(依附于setting)</li>
</ul>
</li>
<li><p>App目录结构</p>
<ul>
<li><p>Info.plist(记录App的基本信息 )</p>
<p>关注Bundle Identifier ,可执行文件名等有用信息</p>
</li>
<li><p>可执行文件</p>
<p> BundleExecutable</p>
</li>
<li><p>lproj目录(本地化字符串)</p>
</li>
</ul>
</li>
<li><p>系统App VS.StoreApp</p>
<ul>
<li><p>目录结构</p>
<p>系统App(Cydia APP):/Applications   权限:root</p>
<p>StoreApp:/var/mobile/Containers/    权限:mobile</p>
</li>
<li><p>安装包格式与权限</p>
<ul>
<li>系统(cydia)App: .deb</li>
<li>storeApp:  .ipa</li>
</ul>
</li>
<li><p>沙盒</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Dynamic Library</p>
<p>在iOS中，lib分为static和dynamic两种:</p>
<p>​    1.其中static lib在编译阶段成为App可执行文件的一部分，会增加可执行文件的大小</p>
<p>​    2.dylib不会改变可执行文件的大小，只有当App需要用到这个dylib时，iOS才会把它加载进内存，成为App进程的一部分</p>
<p>lib 本身并不是可执行文件，不能独立运行，只能为别的进程服务，而且它们寄生在别的进程里，成为了这个进程的一部分。</p>
</li>
<li><p>Deamon(后台) </p>
</li>
</ul>
<p>###OSX工具</p>
<h4 id="1-class-dump"><a href="#1-class-dump" class="headerlink" title="1.class-dump"></a>1.class-dump</h4><ul>
<li>作用:用来dump目标文件的class信息的工具</li>
<li>原理:利用Objective-C语言的runtime的特性，将存储在mach-O文件中的@interface和@protocol信息提取出来，并生成对应的.h文件</li>
<li>安装使用:<a href="https://www.jianshu.com/p/1e3fe0a8c048">https://www.jianshu.com/p/1e3fe0a8c048</a></li>
<li>主要命令行:class-dump -H [.app文件的路径] -o [输出文件夹路径]</li>
<li>局限:没有加密的App。APPStore上的App就需要配合Dumpdecrypted破壳了</li>
</ul>
<h4 id="2-Theos"><a href="#2-Theos" class="headerlink" title="2.Theos"></a>2.Theos</h4><ul>
<li><p>作用:越狱工具开发包(开发工具)</p>
</li>
<li><p>安装使用:<a href="https://www.cnblogs.com/ludashi/p/5714095.html">https://www.cnblogs.com/ludashi/p/5714095.html</a></p>
</li>
<li><p>主要命令行:</p>
<ol>
<li>export THEOS=theos文件所在路径(一般为/opt/theos)</li>
<li>$THEOS/bin/nic.pl        新建工程</li>
<li>make   编译</li>
<li>make package   打包</li>
<li>make install 安装</li>
</ol>
</li>
<li><p>语言:<a href="http://iphonedevwiki.net/index.php/Logos">Logos</a></p>
</li>
</ul>
<h4 id="3-Reveal"><a href="#3-Reveal" class="headerlink" title="3.Reveal"></a>3.Reveal</h4><ul>
<li>作用:监测UI布局</li>
<li>安装教程: <a href="https://blog.csdn.net/hello_hwc/article/details/69365095">https://blog.csdn.net/hello_hwc/article/details/69365095</a></li>
<li>主要命令行:/</li>
<li>注意:OSX与iOS要在同一网段下</li>
</ul>
<h4 id="4-IDA"><a href="#4-IDA" class="headerlink" title="4.IDA"></a>4.IDA</h4><ul>
<li>作用:反汇编工具,看源代码的</li>
<li>下载安装:<a href="https://www.hex-rays.com/products/ida/support/download_demo.shtml">https://www.hex-rays.com/products/ida/support/download_demo.shtml</a></li>
<li>教程:<a href="http://www.freebuf.com/column/157939.html">http://www.freebuf.com/column/157939.html</a></li>
<li>主要操作:空格键 、F5等</li>
<li>难点:汇编</li>
</ul>
<h3 id="iOS工具集"><a href="#iOS工具集" class="headerlink" title="iOS工具集"></a>iOS工具集</h3><h4 id="1-Cydia-Substrate"><a href="#1-Cydia-Substrate" class="headerlink" title="1.Cydia Substrate"></a>1.Cydia Substrate</h4><ul>
<li>作用:绝大部分tweak正常工作的基础，它由MobileHooker、MobileLoade和Safe mode 组成。 cydia商店可直接下载</li>
</ul>
<h4 id="2-cycript"><a href="#2-cycript" class="headerlink" title="2.cycript"></a>2.cycript</h4><ul>
<li>作用:脚本语言,测试(调试)运行的App</li>
<li>安装:cydia直接下载安装</li>
<li>教程:<a href="http://www.cycript.org/manual/、https://www.jianshu.com/p/7c41b03c9eb3">http://www.cycript.org/manual/、https://www.jianshu.com/p/7c41b03c9eb3</a></li>
<li>语言:Objective-C与javascript</li>
</ul>
<h4 id="3-lldb"><a href="#3-lldb" class="headerlink" title="3.lldb"></a>3.lldb</h4><ul>
<li>作用:Xcode自带的调试工具</li>
<li>安装教程:<a href="http://www.qingpingshan.com/rjbc/ios/140197.html">http://www.qingpingshan.com/rjbc/ios/140197.html</a></li>
<li>使用教程:<a href="http://www.dllhook.com/post/51.html">http://www.dllhook.com/post/51.html</a></li>
<li>主要命令行:<ul>
<li>直接启动进程：debugserver -x backboard *:1234 /path/to/app/executable</li>
<li>附加进程：./debugserver *:1234 -a “YourAPPName”</li>
<li>po(打印对象信息) p(打印值) c(继续执行) s、si(单步执行,子函数进入) 、n、ni(单步执行,子函数跳过)</li>
<li>breakpoint 断点设置,详细看书,或者是教程</li>
<li>image list -o -f 模块基地址</li>
</ul>
</li>
</ul>
<h4 id="4-dumpdecrypted"><a href="#4-dumpdecrypted" class="headerlink" title="4.dumpdecrypted"></a>4.dumpdecrypted</h4><ul>
<li>作用:AppStrore榔头,在AppStore下载的app不能直接dump,要配合dumpdecrypted才可以导出头文件信息</li>
<li>使用安装:<a href="https://www.jianshu.com/p/039dfd040253">https://www.jianshu.com/p/039dfd040253</a></li>
<li>主要命令行:DYLD_INSERT_LIBRARIES=/path/to/dumpdecrypted.dylib /path/to/executable</li>
</ul>
<h4 id="5-OpenSSH"><a href="#5-OpenSSH" class="headerlink" title="5.OpenSSH"></a>5.OpenSSH</h4><ul>
<li>作用:iOS设备安装ssh服务,cydia可直接下载</li>
<li>命令行:ssh  scp等</li>
</ul>
<h4 id="6-usbmuxd"><a href="#6-usbmuxd" class="headerlink" title="6.usbmuxd"></a>6.usbmuxd</h4><ul>
<li>作用:usb的ssh服务</li>
</ul>
<h4 id="7-iflie、Filza"><a href="#7-iflie、Filza" class="headerlink" title="7.iflie、Filza"></a>7.iflie、Filza</h4><ul>
<li>作用:iOS文件管理工具</li>
</ul>
<h4 id="8-MTerminal"><a href="#8-MTerminal" class="headerlink" title="8.MTerminal"></a>8.MTerminal</h4><ul>
<li>作用:ios 终端 输入</li>
</ul>
<h4 id="9-syslogd"><a href="#9-syslogd" class="headerlink" title="9.syslogd"></a>9.syslogd</h4><ul>
<li>作用:系统日记</li>
</ul>
<h3 id="优秀资源文章"><a href="#优秀资源文章" class="headerlink" title="优秀资源文章"></a>优秀资源文章</h3><ul>
<li><a href="https://niyaoyao.github.io/2017/05/09/Learning-Reverse-From-Today-D4/">https://niyaoyao.github.io/2017/05/09/Learning-Reverse-From-Today-D4/</a></li>
</ul>
